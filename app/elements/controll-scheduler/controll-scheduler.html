<link rel="import" href="../../bower_components/polymer/polymer.html">
<link rel="import" href="../../bower_components/paper-styles/typography.html">

<dom-module id="controll-scheduler">
</dom-module>

<Script>
Polymer({
	is: 'controll-scheduler',
	Properties: {
		conventionProperties: Object,
		events: Array,
		locations: Array,
		timeslots: Array
	},
	
	attached : function() {
		// handle reload command
		app.addEventListener('please-refresh-lists', this.ready.bind(this), false);
	},
	
	ready : function() {
		this.needData = 4;
		// load stuff that we need for the scheduler
		ConTroll.conventions.getCurrent((function(con){
			this.conventionProperties = con;
			this.needData -= 1;
		}).bind(this));
		app.getCatalog('locations',(function(locations){
			this.locations = locations;
			this.needData -= 1;
		}).bind(this));
		app.getCatalog('events',(function(events){
			this.events = events;
			this.needData -= 1;
		}).bind(this));
		app.getCatalog('timeslots',(function(timeslots){
			this.timeslots = timeslots;
			this.needData -= 1;
		}).bind(this));
		this.waitingToBeReady = window.setInterval(this.waitForDataReady.bind(this),100);
	},
	
	waitForDataReady : function() {
		if (this.needData != 0)
			return;
		window.clearInterval(this.waitingToBeReady);
		delete this.waitingToBeReady;
	}
});
</Script>
